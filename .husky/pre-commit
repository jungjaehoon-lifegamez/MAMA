#!/bin/sh
set -e

# Run lint-staged for staged files (ESLint + Prettier)
npx lint-staged

# Secret scanning with gitleaks
echo "Scanning for secrets..."
if command -v gitleaks >/dev/null 2>&1; then
  gitleaks protect --staged --no-banner
else
  npx gitleaks protect --staged --no-banner 2>/dev/null || echo "⚠️  gitleaks not installed, skipping secret scan"
fi

# Run typecheck for standalone package
echo "Running typecheck..."
pnpm --filter @jungjaehoon/mama-standalone typecheck

# Run tests for changed packages only (faster commits)
# Set CI=true to skip tests that require external services (claude CLI, APIs)
echo "Running tests for changed packages..."
CI=true pnpm --filter "...[HEAD^1]" test
